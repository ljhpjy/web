"use strict";(self.webpackChunkmobile_dangbei_ai=self.webpackChunkmobile_dangbei_ai||[]).push([["135"],{6408:function(e,n,t){var l=t(49674),i=t(779),u=t(82616),r=t(44057),s=t(53490),o=t(51897);t(75045),t(41046),t(83718),t(45718),t(71030),t(58032),t(26644),t(32307),t(77137),t(52802),t(16825),t(46395),t(18566),t(60515),t(96445),t(47763);var c=t(7535),a=t(69161),d=t(26678),f=t(48069),p=t(35770),v=t(33654),h=t(86998);t(38851);var m=t(92890),x=t(72137),b=t(99222),g=t(40921),j=t(62484),N=t(34743),y=t(38415),S=t(31342),w=t(80046),_=t(84934),C=t(70124),E=(0,f.dl)(),P=(0,v.forwardRef)(function(e,n){var t,P=e.onFoucs,M=e.suggestionMessage,k=e.onBlur,Z=e.onCancel,I=e.loading,D=e.onSubmit,U=e.fileUploadOption,A=(0,r._)(e,["onFoucs","suggestionMessage","onBlur","onCancel","loading","onSubmit","fileUploadOption"]),L=(0,v.useRef)(null),R=(0,s._)((0,x.f6)({defaultState:"INPUT",key:"SENDER_INPUT_TYPE"}),2),T=R[0],O=R[1],F=(0,s._)((0,_.p)(null==U?void 0:U.fileList),2),q=F[0],z=F[1],B=(0,s._)((0,v.useState)(!1),2),H=B[0],K=B[1],J=(0,v.useMemo)(function(){return!!A.value.trim()},[A.value]),V=(0,v.useCallback)(function(e){var n;null==e||null==(n=e.stopPropagation)||n.call(e),null==Z||Z()},[Z]);(0,v.useImperativeHandle)(n,function(){return(0,u._)((0,i._)({},L.current),{blur:function(){var e;return null==(e=L.current)?void 0:e.blur()},submit:D})});var W=(0,h.M)(),Y=W.aiModel,G=W.chatModels,Q=(0,v.useMemo)(function(){var e,n="给AI发消息",t=null==G||null==(e=G.modelList)?void 0:e.find(function(e){return e.value===Y});return t&&(n=n.replace("AI",t.title)),n},[Y,G]);(0,x.xI)(function(){null==P||P()}),(0,x.B9)(function(){null==k||k()});var X=(0,v.useRef)(0);(0,v.useEffect)(function(){var e,n=function(){X.current=Date.now()},t=null==L||null==(e=L.current)?void 0:e.nativeElement.querySelector(".ant-sender-input");return null==t||t.setAttribute("enterkeyhint","send"),null==t||t.setAttribute("inputmode","text"),null==t||t.addEventListener("blur",n),function(){null==t||t.removeEventListener("blur",n)}},[]);var $=(0,p.DM)(function(e){if(I)return void C.FN.show({content:(0,c.jsxs)("div",{className:"text-center",children:[(0,c.jsx)("div",{children:"生成中"}),(0,c.jsx)("div",{children:"请稍后发送或停止回答"})]}),position:"center"});var n,t,l=(null==q?void 0:q.length)===1&&(null==(n=q[0])?void 0:n.docId)==="-1",i=null==q?void 0:q.every(function(e){return e.status===j.K.PARSE_SUCCESS});q&&(l||i)&&(null==(t=L.current)||t.blur(),V(),D(e,q),z([]))}),ee=(0,s._)((0,v.useState)(!0),2),en=ee[0],et=ee[1];(0,v.useEffect)(function(){var e,n=null==L||null==(e=L.current)?void 0:e.nativeElement.querySelector(".ant-sender-input");null==n||n.setAttribute("enterkeyhint","send"),null==n||n.setAttribute("inputmode","text")},[]),(0,v.useEffect)(function(){if(q&&(null==q?void 0:q.length)!==0){var e;(null==q||null==(e=q[0])?void 0:e.docId)==="-1"?K(!0):K(null==q?void 0:q.every(function(e){return e.status===j.K.PARSE_SUCCESS}))}else K(!0)},[q]),(0,v.useEffect)(function(){g.ZP.checkPermission("microphone").then(function(e){e||O("INPUT")})},[]);var el=(0,p.DM)((t=(0,l._)(function(e){var n;return(0,o.Jh)(this,function(e){switch(e.label){case 0:return[4,g.ZP.checkPermission("microphone")];case 1:if(!e.sent())return[3,2];return O("AUDIO"),[3,4];case 2:return[4,(0,g.Wd)()];case 3:n="1"===e.sent().appType?"bluetoothConnect":null,g.ZP.requestPermission("microphone",n),e.label=4;case 4:return[2]}})}),function(e){return t.apply(this,arguments)})),ei=(0,p.DM)(function(){H&&$(A.value)}),eu=(0,p.DM)(function(){return er({loading:I})}),er=function(e){var n,t=e.loading,l=[],i=(0,c.jsx)("div",{className:" w-[32px] h-[32px] flex items-center justify-center",onClick:ei,children:(0,c.jsx)("div",{className:(0,f.cx)("w-[22px] h-[22px] bg-primary text-white rounded-full  flex items-center justify-center",{"opacity-40":!H}),children:(0,c.jsx)(y.Z,{type:"icon-SendOutlined",className:"!text-[14px]"})})}),u=(0,c.jsx)(S.Z,{}),r=(0,c.jsx)("div",{className:"w-[32px] h-[32px] flex items-center justify-center",onClick:V,onMouseDown:function(e){return e.stopPropagation()},children:(0,c.jsx)(N.Z,{className:"w-[22px] h-[22px] text-primary "})}),s=(0,c.jsx)("div",{className:"w-[32px] h-[32px]  flex items-center justify-center",onMouseDown:function(e){return e.stopPropagation()},onClick:el,children:(0,c.jsx)(y.Z,{type:"icon-VoiceinputOutlined",className:"!text-[24px]"})}),o=(0,c.jsx)("div",{className:"flex items-center  justify-center w-[32px] h-[32px]",onClick:function(){return O("INPUT")},children:(0,c.jsx)(y.Z,{type:"icon-keyboardOutlined",className:"!text-[24px] switch-input-icon"})});return(null==q?void 0:q.length)===0&&(null==A||null==(n=A.value)?void 0:n.trim())===""&&l.push(u),t?l.push(r):"INPUT"===T?J?l.push(i):l.push(s):l.push(o),(0,c.jsx)("div",{className:"flex space-x-8 items-center leading-0",children:l.map(function(e,n){return(0,c.jsx)(v.Fragment,{children:e},n)})})},es=(0,p.DM)(function(e){return er({loading:"sending"===e||I})});(0,v.useEffect)(function(){z((null==U?void 0:U.fileList)||[])},[null==U?void 0:U.fileList]),(0,v.useEffect)(function(){var e;null==U||null==(e=U.onFileListChange)||e.call(U,q)},[q]);var eo=(0,v.useMemo)(function(){try{if(!E)return U;var e=(0,s._)(E.split("."),1)[0];if(Number(e)>=12)return U;return U&&!!(null==q?void 0:q.length)}catch(e){return U}},[U,null==q?void 0:q.length]);return(0,c.jsxs)("div",{className:"chat-sender-wrapper pt-10 !pb-0 relative z-[10]",children:[void 0===M?null:M,(0,c.jsxs)("div",{className:(0,f.cx)("min-h-[48px] relative bg-white"),children:["AUDIO"===T&&(0,c.jsx)(m.l,{uploading:!H,onCancel:Z,loading:I,className:(0,f.cx)("absolute left-0 bottom-0 w-full box-border z-1 rounded-full"),onSubmit:$,actionNode:es,onRecording:function(e){return et(!e)}}),(0,c.jsx)(a.Z,(0,u._)((0,i._)({header:eo?(0,c.jsx)(a.Z.Header,{open:!!(null==q?void 0:q.length),title:null,closable:!1,className:(0,f.cx)("files-panel-wrapper",{"!border-transparent":!(null==q?void 0:q.length)}),children:(0,c.jsx)(j.Z,{filesList:q,handleFilesList:function(e){z(e)},handleSelectSuggestionMessage:function(e){$(e)}})}):null,components:{input:w.Z},ref:L,placeholder:Q},A),{loading:I,className:(0,f.cx)(A.className,"mt-0 !text-14 rounded-24",{invisible:!T}),onSubmit:$,autoSize:{minRows:1,maxRows:4},actions:eu}))]}),(0,c.jsx)(d.Z,{className:en?"visible":"invisible",onSearchTypeChange:function(){if(Date.now()-X.current<200){var e;null==L||null==(e=L.current)||e.focus()}}}),(0,c.jsx)(b.c,{})]})});P.displayName="ChatSender",n.Z=v.memo(P)},10400:function(e,n,t){t(684),t(70986),t(34088),t(18677),t(51016),t(26601),t(9426),t(93355),t(33262),t(48435),t(91216),t(26409),t(31740),t(62687),t(29957),t(24679),t(46575),t(81273),t(58032),t(81144),t(16825),t(81164),t(28572),t(60833),t(14438),t(46395),t(18566),t(60515),t(19553),t(33654),t(49932),t(48069),t(35770)},53819:function(e,n,t){t(33654)}}]);