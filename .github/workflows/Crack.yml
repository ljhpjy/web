name: Crack

on:
  workflow_dispatch:

permissions:
  contents: write
  actions: write

jobs:

  crack:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        prefix: [
          a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,
          A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z
        ]

    steps:
      - uses: actions/checkout@v3

      - name: Install hashcat
        run: |
          sudo apt-get update
          sudo apt-get install -y hashcat

      - name: Run mask attack
        run: |
          hashcat -m 22000 -a 3 \
            hs/wifi-02.hc22000 \
            "${{ matrix.prefix }}?d?d?d?d?d?d?d?d?d?d?d" \
            -o result_${{ matrix.prefix }}.txt \
            --status --status-timer=60 \
            --potfile-disable || true

      - name: Ensure result exists
        run: |
          if [ ! -f result_${{ matrix.prefix }}.txt ]; then
            touch result_${{ matrix.prefix }}.txt
          fi

      - name: Upload result
        uses: actions/upload-artifact@v4
        with:
          name: results_${{ matrix.prefix }}
          path: result_${{ matrix.prefix }}.txt


  finalize:
    needs: crack
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Download all results
        uses: actions/download-artifact@v4
        with:
          pattern: results_*
          merge-multiple: true

      - name: Merge results
        run: |
          cat result_*.txt 2>/dev/null > all_results.txt || true

      - name: Generate report
        run: |
          echo "Job count:   52" > report.txt
          echo "Mask:        [a-zA-Z] + 11 digits" >> report.txt
          echo "Timestamp:   $(date -u +"%Y-%m-%dT%H:%M:%SZ")" >> report.txt
          echo "" >> report.txt

          if [ -s all_results.txt ]; then
            echo "Status:      PASSWORD FOUND" >> report.txt
            echo "" >> report.txt
            echo "Passwords:" >> report.txt
            cat all_results.txt >> report.txt
          else
            echo "Status:      PASSWORD NOT FOUND" >> report.txt
            echo "" >> report.txt
            echo "No password found in the entire mask space." >> report.txt
          fi

      - name: Upload report
        uses: actions/upload-artifact@v4
        with:
          name: report
          path: report.txt
